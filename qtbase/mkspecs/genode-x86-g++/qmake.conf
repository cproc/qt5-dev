#
# qmake configuration for genode-x86-g++
#

MAKEFILE_GENERATOR      = UNIX
QMAKE_PLATFORM          = genode freebsd unix posix

QMAKE_PREFIX_SHLIB        = lib
QMAKE_EXTENSION_SHLIB     = lib.so
QMAKE_PREFIX_STATICLIB    =
QMAKE_EXTENSION_STATICLIB = lib.a

include(../common/gcc-base-unix.conf)
include(../common/g++-unix.conf)

# modifications to g++.conf
QMAKE_CC                = genode-x86-gcc
QMAKE_CXX               = genode-x86-g++
QMAKE_LINK              = genode-x86-g++
QMAKE_LINK_SHLIB_CMD    = genode-x86-ld \
                          -o $(TARGET) \
                          $$QMAKE_LFLAGS_SHLIB \
                          --whole-archive \
                          --start-group \
                          $(OBJECTS) \
                          $(LIBS) \
                          /home/christian/projects/genode/src/genode_staging/build/x86_64/var/libcache/ld/ld.abi.so \
                          /home/christian/projects/genode/src/genode_staging/build/x86_64/var/libcache/libc/libc.abi.so \
                          /home/christian/projects/genode/src/genode_staging/build/x86_64/var/libcache/ldso-startup/ldso-startup.lib.a \
                          --end-group \
                          --no-whole-archive \
                          /usr/local/genode/tool/19.05/bin/../lib/gcc/x86_64-pc-elf/8.3.0/64/libgcc.a

QMAKE_AR                = genode-x86-ar cqs
QMAKE_OBJCOPY           = genode-x86-objcopy
QMAKE_NM                = genode-x86-nm -P
QMAKE_STRIP             = genode-x86-strip

# for OS detection
QMAKE_CFLAGS            += -D__FreeBSD__=12 -D__GENODE__
QMAKE_CXXFLAGS          += -D__FreeBSD__=12 -D__GENODE__

QMAKE_CFLAGS            += -ffunction-sections
QMAKE_CFLAGS            += -fno-strict-aliasing
QMAKE_CFLAGS            += -nostdinc
QMAKE_CFLAGS            += -m64
QMAKE_CFLAGS            += -mcmodel=large
QMAKE_CFLAGS            += -fPIC

QMAKE_LFLAGS_APP        += -Wl,-melf_x86_64
QMAKE_LFLAGS_APP        += -Wl,-gc-sections
QMAKE_LFLAGS_APP        += -Wl,-z
QMAKE_LFLAGS_APP        += -Wl,max-page-size=0x1000
QMAKE_LFLAGS_APP        += -Wl,--dynamic-list=/home/christian/projects/genode/src/genode_staging/repos/base/src/ld/genode_dyn.dl
QMAKE_LFLAGS_APP        += -nostdlib
QMAKE_LFLAGS_APP        += -Wl,-nostdlib
QMAKE_LFLAGS_APP        += -Wl,-Ttext=0x01000000
QMAKE_LFLAGS_APP        += -m64
QMAKE_LFLAGS_APP        += -mcmodel=large
QMAKE_LFLAGS_APP        += -Wl,--dynamic-linker=ld.lib.so
QMAKE_LFLAGS_APP        += -Wl,--eh-frame-hdr
QMAKE_LFLAGS_APP        += -Wl,-rpath-link=.
QMAKE_LFLAGS_APP        += -Wl,-T -Wl,/home/christian/projects/genode/src/genode_staging/repos/base/src/ld/genode_dyn.ld
QMAKE_LFLAGS_APP        += -Wl,--whole-archive
QMAKE_LFLAGS_APP        += -Wl,--start-group
QMAKE_LFLAGS_APP        += /home/christian/projects/genode/src/genode_staging/build/x86_64/var/libcache/ld/ld.abi.so
QMAKE_LFLAGS_APP        += /home/christian/projects/genode/src/genode_staging/build/x86_64/var/libcache/libc/libc.abi.so
QMAKE_LFLAGS_APP        += /home/christian/projects/genode/src/genode_staging/build/x86_64/var/libcache/libm/libm.abi.so
QMAKE_LFLAGS_APP        += /home/christian/projects/genode/src/genode_staging/build/x86_64/var/libcache/mesa/mesa.abi.so
QMAKE_LFLAGS_APP        += /home/christian/projects/genode/src/genode_staging/build/x86_64/var/libcache/posix/posix.abi.so
QMAKE_LFLAGS_APP        += /home/christian/projects/genode/src/genode_staging/build/x86_64/var/libcache/stdcxx/stdcxx.abi.so
QMAKE_LFLAGS_APP        += -Wl,--end-group
QMAKE_LFLAGS_APP        += -Wl,--no-whole-archive
QMAKE_LFLAGS_APP        += /usr/local/genode/tool/19.05/bin/../lib/gcc/x86_64-pc-elf/8.3.0/64/libgcc.a

QMAKE_LFLAGS_SHLIB      += --eh-frame-hdr
QMAKE_LFLAGS_SHLIB      += -melf_x86_64
QMAKE_LFLAGS_SHLIB      += -gc-sections
QMAKE_LFLAGS_SHLIB      += -z max-page-size=0x1000
QMAKE_LFLAGS_SHLIB      += -T /home/christian/projects/genode/src/genode_staging/repos/base/src/ld/genode_rel.ld
QMAKE_LFLAGS_SHLIB      += --entry=0x0
QMAKE_LFLAGS_SHLIB      += --whole-archive
QMAKE_LFLAGS_SHLIB      += --start-group
QMAKE_LFLAGS_SHLIB      += --end-group
QMAKE_LFLAGS_SHLIB      += --no-whole-archive
QMAKE_LFLAGS_SHLIB      += /usr/local/genode/tool/19.05/bin/../lib/gcc/x86_64-pc-elf/8.3.0/64/libgcc.a

# QMAKE_INCDIR is ignored when building qtwebengine
QMAKE_CFLAGS            += -I/usr/local/genode/tool/19.05/bin/../lib/gcc/x86_64-pc-elf/8.3.0/include
QMAKE_CFLAGS            += -I/home/christian/projects/genode/src/genode_staging/contrib/expat-eff6ef1bf28d085182756084b4ffbf00ce4fa6ce/include
QMAKE_CFLAGS            += -I/home/christian/projects/genode/src/genode_staging/contrib/libc-2e544dd702682f943d262077d71bfaf6132edcef/include/libc
QMAKE_CFLAGS            += -I/home/christian/projects/genode/src/genode_staging/contrib/libc-2e544dd702682f943d262077d71bfaf6132edcef/include/spec/x86/libc
QMAKE_CFLAGS            += -I/home/christian/projects/genode/src/genode_staging/contrib/libc-2e544dd702682f943d262077d71bfaf6132edcef/include/spec/x86_64/libc
QMAKE_CFLAGS            += -I/home/christian/projects/genode/src/genode_staging/contrib/libc-2e544dd702682f943d262077d71bfaf6132edcef/include/spec/x86_64/libc/machine
QMAKE_CFLAGS            += -I/home/christian/projects/genode/src/genode_staging/contrib/mesa-6835d67506c800140e54b384baa5b070c8e48aeb/include
QMAKE_CFLAGS            += -I/home/christian/projects/genode/src/genode_staging/repos/libports/include/stdcxx
QMAKE_CFLAGS            += -I/home/christian/projects/genode/src/genode_staging/contrib/stdcxx-79ad8821269a443aab21bfc1d0e9b8913332b6d1/include/stdcxx
QMAKE_CFLAGS            += -I/home/christian/projects/genode/src/genode_staging/contrib/stdcxx-79ad8821269a443aab21bfc1d0e9b8913332b6d1/include/stdcxx/c_global
QMAKE_CFLAGS            += -I/home/christian/projects/genode/src/genode_staging/contrib/stdcxx-79ad8821269a443aab21bfc1d0e9b8913332b6d1/include/stdcxx/std

QMAKE_CXXFLAGS          += $$QMAKE_CFLAGS
QMAKE_CXXFLAGS          += -fpermissive

# needed for configure test
QMAKE_INCDIR_OPENGL     = /home/christian/projects/genode/src/genode_staging/contrib/mesa-6835d67506c800140e54b384baa5b070c8e48aeb/include

load(qt_config)
